## Chapter13.事件

JavaScript和HTML之间的交互是通过事件实现的。也就是文档和浏览器窗口中发生的一些特定的交互瞬间。

可以使用侦听器来预定事件，以便事件发生时执行相应的代码。这种在传统软件工程中被称之为观察员模式的模型，支持页面的行为(JavaScript代码)
与页面的外观(HTML和CSS代码)之间的松散耦合。

DOM2Event统合了原本只是各个浏览器专有的API，得到IE9+等浏览器的支持，IE8是最后一代仍使用专有事件系统的主要浏览器。

尽管主要浏览器已经实现了DOM2Event，但是这个规范并没有涵盖所有事件类型，BOM也支持一定的事件，而且没有什么规范，随着DOM3Event的出现，
事件相关的API变得更加繁琐复杂，难易程度会根据你的需求而不同。不过有关事件的一些核心概念是必须要理解的。

#### 13.1 事件流

事件流是描述从页面中接收事件的顺序(单击一个按钮的同时，你也单击了这个按钮的容器，以及容器的容器等等)。而作为远古时期的巨头，IE和网景
一个采用了事件冒泡，一个采用了事件捕获。

**13.1.1 事件冒泡(event bubbling)**

事件最开始由最具体的元素接收，然后逐级向上传播到文档。

现代所有浏览器都支持事件冒泡，但是在具体实现上有一定差别。IE9以后的现代浏览器会一直冒泡到window对象。

**13.1.2 事件捕获(event capturing)**

事件捕获的具体思想是不太具体的节点应该更早接收到事件，最具体的节点应该最后接收到事件。用意在于在事件到达预定目标之前捕获它。

IE9之后的新浏览器都支持这种事件流，虽然规范要求事件从document开始，但实际上都是从window对象开始的。由于老版本浏览器不支持，所以很少
有人使用事件捕获。仅仅出现在有特殊需要时。

**13.1.3 DOM事件流**

DOM2Event规定的事件流包括三个阶段，事件捕获阶段、处于目标阶段、事件冒泡阶段。

在DOM事件流中，实际的目标在捕获阶段并不会接收到事件，在捕获阶段事件从文档传递到实际目标的上一层级时便停止了，下一个阶段是处于目标阶段，
于是事件发生并在事件处理中被看作事件冒泡的一部分。

即使DOM2Event明确要求事件捕获阶段不会涉及事件的目标，但IE9等现代浏览器都会在捕获阶段触发事件对象上的事件。

#### 13.2 事件处理程序

事件就是用户或者浏览器执行的某种动作，诸如click、load、mouseover等，都是事件的名字。而响应某种事件的函数就叫做事件处理程序。事件处理
程序的名字一般以"on"开头，为事件指定处理程序的方式有很多种。

**13.2.1 HTML事件处理程序**

在HTML中直接写入事件处理程序有以下集中形式。

    //在代码部分使用单引号避免使用HTML实体
    <input type="button" value="Click me" onclick="alert('Clicked')" />

    //也可以使用如下转义方式
    <input type="button" value="Click me" onclick="alert(&quot;Clicked&quot;)" />

    //调用页面其他位置的脚本
    <script>
        function showMessage () {
            alert("Clicked");
        }
    </script>
    <input type="button" value="Click me" onclick="showMessage()" />
最后一个例子中的函数是独立定义的，也可以来自外部js文件，当事件处理程序中的代码执行时，有权访问全局作用域中的任何代码。

通过直接写入HTML指定事件处理程序有一些优势：

* 首先这样会创建一个封装着元素属性值的函数，这个函数中又一个局部变量event，也就是事件对象。
  通过event变量可以直接访问事件对象，你并不用手动定义它，也不用从函数的参数列表中读取它。

        <input type="button" value="Click me" onclick="alert(event.type)" />      //输出click
  在这个函数的内部，this的值等于事件的目标元素。

        <input type="button" value="Click me" onclick="alert(this.value)" />      //输出"Click me"

* 关于这个动态创建的函数，另一个重要的优势是它扩展作用域的方式。

